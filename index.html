<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="outer">
    <div class="plan">
        <img width="1000" height="194" src="images/4floor(crop).png" alt="">
        <canvas id="canvas" width="1000" height="194"></canvas>
    </div>
</div>

<script>
    const radius = 5

    let idCounter = 0
    let canv = document.getElementById('canvas')
    let ctx = canv.getContext('2d')

    let state = {
        points: {}
    };

     canv.addEventListener('mousedown', (event) => {
         let x = event.offsetX
         let y = event.offsetY

         let nodeId = getNodeIdAtPoint(x, y)
         state.mouseDownPointId = nodeId
     })

    canv.addEventListener('mouseup', (event) => {
        let x = event.offsetX
        let y = event.offsetY

        let nodeId = getNodeIdAtPoint(x, y)
        state.mouseUpPointId = nodeId

        checkIfNeedDrawEdge()

    })

    function checkIfNeedDrawEdge() {
         let startPoint = state.mouseDownPointId
         let endPoint = state.mouseUpPointId

        if (startPoint !== -1 && endPoint !== -1 && startPoint !== endPoint) {
            let xStart = state.points[startPoint].x
            let yStart = state.points[startPoint].y
            let xEnd = state.points[endPoint].x
            let yEnd = state.points[endPoint].y

            ctx.beginPath()
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#ff0000';
            ctx.moveTo(xStart, yStart)
            ctx.lineTo(xEnd, yEnd)
            ctx.stroke()
        }
    }

    canv.addEventListener("click", function (event) {
        let x = event.offsetX
        let y = event.offsetY

        let nodeId = getNodeIdAtPoint(x, y)

        if (nodeId !== -1)
            return

        if (!state.points) {
            state.points = [];
        }

        state.points[idCounter++] = {
            'x': x,
            'y': y
        }

        console.log(state.points)


        ctx.beginPath();
        ctx.lineWidth = 5;
        ctx.fillStyle = 'red';
        ctx.strokeStyle = 'red';
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        /*ctx.fill();*/
        ctx.stroke();
    })

    function getNodeIdAtPoint(x, y) {
        for (const [id, point] of Object.entries(state.points)) {
            let xContain = x >= point.x - radius & x <= point.x + radius;
            let yContain = y >= point.y - radius & y <= point.y + radius;
            if (xContain & yContain)
                return id
        }
        return -1;
    }

</script>
</body>
</html>